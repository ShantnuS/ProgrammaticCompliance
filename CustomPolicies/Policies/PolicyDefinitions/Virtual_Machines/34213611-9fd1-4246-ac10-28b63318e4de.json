{
  "id": "/providers/Microsoft.Authorization/policyDefinitions/34213611-9fd1-4246-ac10-28b63318e4de",
  "name": "34213611-9fd1-4246-ac10-28b63318e4de",
  "properties": {
    "description": "Description Custom Manual - MCSB Baseline item IM-3 for Virtual Machines",
    "displayName": "MCSB Baseline item IM-3 for Virtual Machines",
    "metadata": {
      "offeringName": "Virtual Machines",
      "offeringId": "07649cbd-2ee4-4992-898b-f5f16bad1b36",
      "mcsb": {
        "mcsbId": "IM-3",
        "features": [
          {
            "featureId": "MANAGED_IDENTITIES",
            "featureName": "Managed Identities",
            "featureDescription": "Data plane actions support authentication using managed identities.",
            "featureSupport": "True",
            "featureGuidance": "Use Azure managed identities instead of service principals when possible, which can authenticate to Azure services and resources that support Azure Active Directory (Azure AD) authentication. Managed identity credentials are fully managed, rotated, and protected by the platform, avoiding hard-coded credentials in source code or configuration files.",
            "featureReference": "Not Applicable",
            "enabledByDefault": "False",
            "customerActionsDescription": "Manage application identities securely and automatically"
          },
          {
            "featureId": "SERVICE_PRINCIPAL",
            "featureName": "Service Principals",
            "featureDescription": "Data plane supports authentication using service principals.",
            "featureSupport": "True",
            "featureGuidance": "There is no current Microsoft guidance for this feature configuration. Please review and determine if your organization wants to configure this security feature.",
            "featureReference": "Not Applicable",
            "enabledByDefault": "False",
            "customerActionsDescription": "Manage application identities securely and automatically"
          }
        ],
        "automatedPolicyAvailability": [
          {
            "policyId": "d26f7642-7545-4e18-9b75-8c9bbdee3a9a",
            "policyName": "Virtual machines' Guest Configuration extension should be deployed with system-assigned managed identity",
            "policyDescription": "The Guest Configuration extension requires a system assigned managed identity. Azure virtual machines in the scope of this policy will be non-compliant when they have the Guest Configuration extension installed but do not have a system assigned managed identity. Learn more at https://aka.ms/gcpol",
            "policyCategory": "Security Center"
          }
        ],
        "frameworkControls": [
          "NIST_SP_800-53_R4_IA-9",
          "NIST_SP_800-53_R4_IA-5",
          "NIST_SP_800-53_R4_IA-4",
          "NIST_SP_800-53_R4_AC-3",
          "NIST_SP_800-53_R4_AC-2",
          "PCI_DSS_v4.0_8.6.3",
          "PCI_DSS_v4.0_8.6.2",
          "PCI_DSS_v4.0_8.6.1"
        ]
      },
      "version": "1.0.0",
      "category": "Regulatory Compliance"
    },
    "mode": "All",
    "policyType": "Custom",
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "in": [
              "Microsoft.Resources/subscriptions",
              "Microsoft.Resources/subscriptions/resourceGroups"
            ]
          },
          {
            "value": "false",
            "equals": "true"
          }
        ]
      },
      "then": {
        "effect": "Manual",
        "details": {
          "defaultState": "Unknown"
        }
      }
    }
  }
}