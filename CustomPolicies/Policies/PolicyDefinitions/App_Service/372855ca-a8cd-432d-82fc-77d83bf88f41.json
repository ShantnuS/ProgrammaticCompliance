{
  "id": "/providers/Microsoft.Authorization/policyDefinitions/372855ca-a8cd-432d-82fc-77d83bf88f41",
  "name": "372855ca-a8cd-432d-82fc-77d83bf88f41",
  "properties": {
    "description": "Description Custom Manual - MCSB Baseline item IM-3 for App Service",
    "displayName": "MCSB Baseline item IM-3 for App Service",
    "metadata": {
      "offeringName": "App Service",
      "offeringId": "c7f69506-5b4f-4751-b423-0095e68fad64",
      "mcsb": {
        "mcsbId": "IM-3",
        "features": [
          {
            "featureId": "MANAGED_IDENTITIES",
            "featureName": "Managed Identities",
            "featureDescription": "Data plane actions support authentication using managed identities.",
            "featureSupport": "True",
            "featureGuidance": "Use Azure managed identities instead of service principals when possible, which can authenticate to Azure services and resources that support Azure Active Directory (Azure AD) authentication. Managed identity credentials are fully managed, rotated, and protected by the platform, avoiding hard-coded credentials in source code or configuration files.\r\n\r\nA common scenario to use a managed identity with App Service is to access other Azure PaaS services such as Azure SQL Database, Azure Storage, or Key Vault.",
            "featureReference": "https://docs.microsoft.com/azure/app-service/overview-managed-identity",
            "enabledByDefault": "False",
            "customerActionsDescription": "Manage application identities securely and automatically"
          },
          {
            "featureId": "SERVICE_PRINCIPAL",
            "featureName": "Service Principals",
            "featureDescription": "Data plane supports authentication using service principals.",
            "featureSupport": "True",
            "featureGuidance": "Though service principals are supported by the service as a pattern for authentication, we recommend using Managed Identities where possible instead.",
            "featureReference": "Not Applicable",
            "enabledByDefault": "False",
            "customerActionsDescription": "Manage application identities securely and automatically"
          }
        ],
        "automatedPolicyAvailability": [
          {
            "policyId": "0da106f2-4ca3-48e8-bc85-c638fe6aea8f",
            "policyName": "Function apps should use managed identity",
            "policyDescription": "Use a managed identity for enhanced authentication security",
            "policyCategory": "App Service"
          },
          {
            "policyId": "2b9ad585-36bc-4615-b300-fd4435808332",
            "policyName": "App Service apps should use managed identity",
            "policyDescription": "Use a managed identity for enhanced authentication security",
            "policyCategory": "App Service"
          }
        ],
        "frameworkControls": [
          "NIST_SP_800-53_R4_IA-9",
          "NIST_SP_800-53_R4_IA-5",
          "NIST_SP_800-53_R4_IA-4",
          "NIST_SP_800-53_R4_AC-3",
          "NIST_SP_800-53_R4_AC-2",
          "PCI_DSS_v4.0_8.6.3",
          "PCI_DSS_v4.0_8.6.2",
          "PCI_DSS_v4.0_8.6.1"
        ]
      },
      "version": "1.0.0",
      "category": "Regulatory Compliance"
    },
    "mode": "All",
    "policyType": "Custom",
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "in": [
              "Microsoft.Resources/subscriptions",
              "Microsoft.Resources/subscriptions/resourceGroups"
            ]
          },
          {
            "value": "false",
            "equals": "true"
          }
        ]
      },
      "then": {
        "effect": "Manual",
        "details": {
          "defaultState": "Unknown"
        }
      }
    }
  }
}